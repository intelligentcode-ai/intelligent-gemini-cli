# Mega PRB Template - System-Wide Changes
# Auto-selected for highly sophisticated instruction complexity (30+ points) - AI executes instantly
# Manages multiple Large PRBs with system-wide coordination

# ⚠️ CRITICAL: ALL 6 SECTIONS MANDATORY - SKIP NOTHING
# ⚠️ SETTINGS ENFORCEMENT: git_privacy: true = NO AI mentions in commits
# ⚠️ CASCADING INHERITANCE: All Large sub-PRBs inherit ALL 6 mandatory sections

id: "[PARENT_ID]-PRB-[NEXT_NUMBER]-[TITLE]-[CURRENT_DATE]"
type: mega-prb
complexity: system-wide
priority: "[PRIORITY_LEVEL]"  # CRITICAL, HIGH, MEDIUM, LOW
title: "[MAJOR_INITIATIVE]"
requires_epic_decomposition: true

# MANDATORY: Complete Context Section
complete_context:
  project: "Dynamically injected project context from GEMINI.md."
  settings: "Dynamically injected all configuration values."
  git_privacy: "Dynamically injected git_privacy setting from config."
  branch_protection: "Dynamically injected branch_protection from config."
  default_branch: "Dynamically injected default_branch from config."
  branch_strategy: "Dynamically injected branch_prefixes from config."
  business_driver: "Describe the core business reason or problem this system-wide change addresses."
  impact_scope: "Outline all affected systems, modules, or teams."
  risk_level: "Assess the risk level (e.g., HIGH, CRITICAL) for this system-wide change."
  rollback_required: true # Indicates if a rollback plan is mandatory.
  best_practices: [] # Dynamically injected relevant best practices.
  
# MANDATORY: Requirements Section
requirements:
  functional:
    - "Describe the high-level functional requirements for this system-wide change."
    - "Break down complex system-wide goals into functional components."
    - "Specify expected system behaviors and interactions across all affected areas."
  processual:
    - "Respect git_privacy setting across all phases and sub-PRBs"
    - "Follow branch protection strategy for all components"
    - "Use configured default branch for final system integration"
    - "Apply configured branch naming across all phases"
    - "Coordinate multi-phase execution with dependency management"
    - "Ensure all Large sub-PRBs inherit complete context"
  technical:
    - "System-wide architectural changes"
    - "Multi-phase coordination"
    - "30+ instruction sophistication management"
    - "Backwards compatibility maintenance"

# Phases with Large PRBs
phases:
  # ALL LARGE SUB-PRBS INHERIT COMPLETE CONTEXT AND MANDATORY SECTIONS
  - name: "Analysis & Planning"
    prbs:
      - type: large
        title: "System architecture analysis"
        focus: "[CURRENT_STATE_ANALYSIS]"
        complete_context:
          inherit_all: true  # Inherits ALL parent context
          project: "[CLAUDE.md]"
          settings: "[ALL-SETTINGS]"
          git_privacy: "[FROM_CONFIG]"
          branch_protection: "[FROM_CONFIG]"
          default_branch: "[FROM_CONFIG]"
          branch_strategy: "[FROM_CONFIG]"
        requirements:
          functional: ["[ARCHITECTURE_ANALYSIS_REQUIREMENTS]"]
          processual:
            - "Respect git_privacy setting across all analysis outputs"
            - "Follow branch protection strategy for analysis branches"
            - "Use configured default branch for integration"
            - "Apply configured branch naming for analysis work"
          technical: ["[SYSTEM_ANALYSIS_TECH_SPECS]"]
        git_operations:
          branch_strategy: "[FROM_CONFIG]"
          branch_protection: "[FROM_CONFIG]"
          privacy_filter: "[FROM_CONFIG]"
          default_branch: "[FROM_CONFIG]"
        knowledge_management:
          structure: "memory/[topic]/[subtopic].md"
          storage: "version-controlled"
        review_process:
          type: "architecture_review"
          inherit_from_parent: true
        implementation_samples:
          example_scope: "System architecture analysis with 5+ Medium sub-PRBs"
        
      - type: large
        title: "Risk assessment and mitigation"
        focus: "[RISK_PLANNING]"
        complete_context:
          inherit_all: true  # Inherits ALL parent context
          project: "[CLAUDE.md]"
          settings: "[ALL-SETTINGS]"
          git_privacy: "[FROM_CONFIG]"
          branch_protection: "[FROM_CONFIG]"
          default_branch: "[FROM_CONFIG]"
          branch_strategy: "[FROM_CONFIG]"
        requirements:
          functional: ["[RISK_ASSESSMENT_REQUIREMENTS]"]
          processual:
            - "Respect git_privacy setting for risk documentation"
            - "Follow branch protection strategy for risk planning"
            - "Use configured default branch for risk integration"
            - "Apply configured branch naming for risk work"
          technical: ["[RISK_MITIGATION_TECH_SPECS]"]
        git_operations:
          branch_strategy: "[FROM_CONFIG]"
          branch_protection: "[FROM_CONFIG]"
          privacy_filter: "[FROM_CONFIG]"
          default_branch: "[FROM_CONFIG]"
        knowledge_management:
          structure: "memory/[topic]/[subtopic].md"
          storage: "version-controlled"
        review_process:
          type: "risk_review"
          inherit_from_parent: true
        implementation_samples:
          example_scope: "Risk assessment with 3+ Medium sub-PRBs"
        
  - name: "Implementation"
    prbs:
      - type: large
        title: "Describe the major component (e.g., Core API Module)."
        parallel_safe: true # Indicates if this PRB can be executed in parallel with others.
        complete_context:
          inherit_all: true  # Inherits ALL parent context
          # No need to specify project, settings, git_privacy, etc. here if inherit_all is true.
        requirements:
          functional: ["Describe functional requirements for this component."]
          processual:
            - "Respect git_privacy setting for implementation commits"
            - "Follow branch protection strategy for component development"
            - "Use configured default branch for component integration"
            - "Apply configured branch naming for implementation work"
          technical: ["Specify technical details for this component."]
        git_operations:
          branch_strategy: "Dynamically inherited from parent PRB."
          branch_protection: "Dynamically inherited from parent PRB."
          privacy_filter: "Dynamically inherited from parent PRB."
          default_branch: "Dynamically inherited from parent PRB."
        knowledge_management:
          structure: "memory/[topic]/[subtopic].md" # Example: memory/implementation/core-api.md
          storage: "not-version-controlled" # Knowledge in ./memory should NEVER be version controlled for this project.
        review_process:
          type: "implementation_review"
          inherit_from_parent: true
        implementation_samples:
          example_scope: "Major component with multiple Medium sub-PRBs."
        
      - type: large  
        title: "Describe another major component (e.g., Data Processing Service)."
        parallel_safe: true
        complete_context:
          inherit_all: true  # Inherits ALL parent context
          # No need to specify project, settings, git_privacy, etc. here if inherit_all is true.
        requirements:
          functional: ["Describe functional requirements for this component."]
          processual:
            - "Respect git_privacy setting for implementation commits"
            - "Follow branch protection strategy for component development"
            - "Use configured default branch for component integration"
            - "Apply configured branch naming for implementation work"
          technical: ["Specify technical details for this component."]
        git_operations:
          branch_strategy: "Dynamically inherited from parent PRB."
          branch_protection: "Dynamically inherited from parent PRB."
          privacy_filter: "Dynamically inherited from parent PRB."
          default_branch: "Dynamically inherited from parent PRB."
        knowledge_management:
          structure: "memory/[topic]/[subtopic].md" # Example: memory/implementation/data-processing.md
          storage: "not-version-controlled" # Knowledge in ./memory should NEVER be version controlled for this project.
        review_process:
          type: "implementation_review"
          inherit_from_parent: true
        implementation_samples:
          example_scope: "Major component with multiple Medium sub-PRBs."
        
  - name: "Migration & Validation"
    prbs:
      - type: large
        title: "Data migration strategy"
        critical_path: true # Indicates if this PRB is on the critical path for the overall project.
        complete_context:
          inherit_all: true  # Inherits ALL parent context
          # No need to specify project, settings, git_privacy, etc. here if inherit_all is true.
        requirements:
          functional: ["Describe functional requirements for data migration."]
          processual:
            - "Respect git_privacy setting for migration scripts"
            - "Follow branch protection strategy for migration work"
            - "Use configured default branch for migration integration"
            - "Apply configured branch naming for migration branches"
          technical: ["Specify technical details for data migration."]
        git_operations:
          branch_strategy: "Dynamically inherited from parent PRB."
          branch_protection: "Dynamically inherited from parent PRB."
          privacy_filter: "Dynamically inherited from parent PRB."
          default_branch: "Dynamically inherited from parent PRB."
        knowledge_management:
          structure: "memory/[topic]/[subtopic].md" # Example: memory/migration/data-strategy.md
          storage: "not-version-controlled" # Knowledge in ./memory should NEVER be version controlled for this project.
        review_process:
          type: "migration_review"
          inherit_from_parent: true
        implementation_samples:
          example_scope: "Data migration with multiple Medium sub-PRBs."
        
# Ultra thinking mandatory
ultra_thinking:
  mandatory: true
  command: "/icc-think-sequential"
  depth: "maximum"
  considerations:
    - "Define the boundaries of the system being affected."
    - "Assess the performance impact of the changes."
    - "Ensure backwards compatibility with existing systems."
    - "Identify and plan for potential failure scenarios."
    
# Multi-role collaboration
collaboration_model:
  leadership:
    pm: "@PM"
    architect: "@AI-Architect"
    tech_lead: "@System-Engineer"
    
  specialist_pool: [] # Dynamically assigned specialists based on project needs.
    
  coordination: "continuous" # Describes how collaboration is coordinated.
  
# System-wide validation
validation_framework:
  checkpoints:
    - "Describe the validation checkpoint (e.g., 'Architecture review after Phase 1')."
    - "Specify the type of check (e.g., 'Security audit', 'Performance validation')."
    - "Indicate when the checkpoint occurs (e.g., 'after Phase 2', 'before deployment')."
    
# MANDATORY: Git Operations Section
# ⚠️ git_privacy: true = NO "Generated with Claude Code", NO "Co-Authored-By: Claude"
# ⚠️ CASCADING PRIVACY: All Large sub-PRBs must follow same git privacy settings
git_operations:
  branch_strategy: "Dynamically injected from config (e.g., 'feature/')."
  branch_protection: "Dynamically injected from config (e.g., 'true')."
  branch_coordination: "feature-branch-per-phase" # Describes how branching is coordinated across phases.
  integration_strategy: "progressive-merge" # Describes the strategy for integrating changes.
  privacy_filter: "Dynamically injected from config (e.g., 'true')."
  default_branch: "Dynamically injected from config (e.g., 'main')."
  version_bump: "Specify 'MAJOR' for system-wide changes."
  main_protection: "mandatory" # Indicates if main branch protection is mandatory.

# MANDATORY: Knowledge Management Section
knowledge_management:
  structure: "memory/[topic]/[subtopic].md" # Example: memory/architecture/system-design.md
  storage: "not-version-controlled" # Knowledge in ./memory should NEVER be version controlled for this project.
  system_wide_capture: true # Indicates that knowledge is captured across the entire system.
  phase_learning_aggregation: true # Indicates that learnings are aggregated per phase.
  mandatory_documentation:
    - "List mandatory architectural decisions to be documented."
    - "Outline patterns for data migration."
    - "Describe procedures for system rollback."
  format: "ArchitecturalDecisionRecord" # Specifies the format for architectural decisions.

# MANDATORY: Review Process Section
review_process:
  type: "multi_phase_governance"
  checkpoints:
    - "Describe the review checkpoint (e.g., 'Architecture review after Phase 1')."
    - "Specify the type of review (e.g., 'Security audit', 'Performance validation')."
    - "Indicate when the review occurs (e.g., 'after Phase 2', 'before deployment')."
  leadership:
    pm: "@PM" # Project Manager for overall coordination.
    architect: "@AI-Architect" # Architect for technical oversight.
    tech_lead: "@System-Engineer" # Technical Lead for implementation guidance.
  escalation: "executive_review" # Describes the escalation process for review issues.

# MANDATORY: Documentation Management Section
documentation_management:
  required_updates:
    changelog:
      file: "CHANGELOG.md"
      entry_format: |
        ## [MAJOR_VERSION] - DATE
        ### BREAKING CHANGES
        - [SYSTEM_WIDE_BREAKING_CHANGES]
        - [MIGRATION_REQUIREMENTS]
        ### Added
        - [MAJOR_SYSTEM_CAPABILITIES]
        - [NEW_ARCHITECTURAL_COMPONENTS]
        ### Changed
        - [FUNDAMENTAL_SYSTEM_CHANGES]
        - [PERFORMANCE_IMPROVEMENTS]
        ### Removed
        - [DEPRECATED_FEATURES_REMOVED]
        ### Migration Guide
        - [STEP_BY_STEP_MIGRATION_INSTRUCTIONS]
      semantic_versioning: true
      breaking_changes: true
      mandatory: true
      
    readme:
      file: "README.md"  
      update_required: "YES" # Always for system-wide changes
      sections_affected: "[ALL_MAJOR_SECTIONS]"
      user_impact: "[COMPREHENSIVE_SYSTEM_OVERHAUL_DESCRIPTION]"
      breaking_changes_notice: "YES"
      
    api_docs:
      update_required: "YES" # System-wide changes always affect APIs
      files_affected: "[ALL_API_DOCUMENTATION]"
      breaking_changes: "YES" # Major versions typically have breaking changes
      new_endpoints: "[NEW_API_SURFACES]"
      deprecated_endpoints: "[DEPRECATED_API_LIST]"
      
    user_guides:
      update_required: "YES" # System overhaul requires new guides
      guides_affected: "[ALL_USER_DOCUMENTATION]"
      new_workflows: "[COMPREHENSIVE_WORKFLOW_CHANGES]"
      migration_tutorials: "YES"
    
    architecture_docs:
      update_required: "YES" # System-wide changes = architecture changes
      files_affected: "[docs/architecture/*.md]"
      decision_records: "YES" # ADRs required for major changes
      system_diagrams: "YES" # Visual updates required
      
  release_management:
    github_release: "YES"                    # Always for major versions
    release_notes: "COMPREHENSIVE"           # Detailed system change documentation
    migration_guide: "YES"                   # Always required for major versions
    announcement: "YES"                      # Major system changes need announcement
    blog_post: "RECOMMENDED"                 # Consider detailed blog post
    user_communication: "MULTI_CHANNEL"      # Email, docs, social media
    
  validation_checklist:
    - "CHANGELOG.md updated with comprehensive breaking changes and migration info"
    - "Version bumped (major) for system-wide breaking changes"
    - "README.md completely updated reflecting new system architecture"
    - "All API documentation updated with breaking changes clearly marked"
    - "User guides rewritten for new system workflows"
    - "Architecture documentation updated with decision records"
    - "GitHub release created with comprehensive release notes"
    - "Migration guide provided with step-by-step instructions"
    - "User communication plan executed across all channels"
    - "System diagrams updated to reflect new architecture"

# MANDATORY: Implementation Samples Section
# ⚠️ EXECUTION CHECKLIST: All 6 sections + cascading phase coordination must be completed
implementation_samples:
  example_scope: "[MEGA-001]: Complete system architecture overhaul"
  example_phases: |
    Phase 1: Analysis & Planning (2 Large PRBs)
    Phase 2: Core Implementation (3 Large PRBs)
    Phase 3: Migration & Validation (2 Large PRBs)
    Each Large PRB contains 2-4 Medium PRBs
    System-wide impact across 50+ files

  execution_checklist: |
    ☐ Complete Context Section - Settings and scope loaded for parent + all phases
    ☐ Requirements Section - All system-wide functional/processual/technical requirements met
    ☐ Git Operations Section - Multi-phase coordination with privacy_filter for all
    ☐ Documentation Updates Section - All system docs including migration procedures updated
    ☐ Knowledge Management Section - Architectural decisions + patterns captured
    ☐ Review Process Section - Multi-gate reviews completed across all phases
    ☐ Documentation Management Section - COMPREHENSIVE system documentation updated
    ☐ Implementation Samples Section - Applied with proper phase coordination
    ☐ LARGE PRB INHERITANCE - All Large sub-PRBs have complete 6-section context
    ☐ CASCADING EXECUTION - Each Large PRB follows its own mandatory checklist
    ☐ PROGRESSIVE VALIDATION - Each phase validates before proceeding
    
    SKIP NOTHING. EXECUTE EVERYTHING. COORDINATE ALL PHASES AND SUB-PRBS. COMPLETE SYSTEM LIFECYCLE.

# Comprehensive learning
learning_strategy:
  mandatory_documentation:
    - "List mandatory architectural decisions to be documented."
    - "Outline patterns for data migration."
    - "Describe procedures for system rollback."
  format: "ArchitecturalDecisionRecord" # Specifies the format for architectural decisions.